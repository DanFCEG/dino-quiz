<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dino Quiz!</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@700;900&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Nunito', 'Segoe UI', cursive, sans-serif;
      background: linear-gradient(160deg, #a8edea, #fed6e3);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 20px;
      overflow-x: hidden;
    }

    h1 {
      font-family: 'Fredoka One', cursive;
      font-size: clamp(2rem, 7vw, 3.5rem);
      color: #4a2f8a;
      text-shadow: 3px 3px 0 #f9c846;
      margin-bottom: 8px;
      text-align: center;
      letter-spacing: 3px;
    }

    #score-bar {
      display: flex;
      gap: 20px;
      align-items: center;
      justify-content: center;
      font-size: clamp(1rem, 4vw, 1.4rem);
      font-weight: bold;
      color: #4a2f8a;
      margin-bottom: 18px;
      flex-wrap: wrap;
    }

    #star-display { font-size: 1.4rem; letter-spacing: 3px; color: #f9a825; }

    #music-btn {
      background: linear-gradient(135deg, #7c4dff, #e040fb);
      color: white; border: none; border-radius: 30px;
      padding: 8px 22px;
      font-size: clamp(0.85rem, 2.5vw, 1rem);
      font-weight: 900; cursor: pointer; letter-spacing: 1px;
      box-shadow: 0 3px 10px rgba(124,77,255,0.3);
      transition: transform 0.15s; margin-bottom: 10px;
    }
    #music-btn:hover { transform: scale(1.07); }
    #music-btn.on { background: linear-gradient(135deg, #00897b, #26c6da); }

    #skip-btn {
      margin-top: 8px; margin-left: 10px;
      padding: clamp(12px, 3vw, 18px) clamp(18px, 5vw, 32px);
      font-size: clamp(1rem, 3.5vw, 1.3rem); font-weight: 900;
      background: linear-gradient(135deg, #bdbdbd, #9e9e9e);
      color: white; border: none; border-radius: 50px; cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transition: transform 0.15s; display: none; letter-spacing: 1px;
    }
    #skip-btn:hover { transform: scale(1.05); }

    #game-area {
      background: #fffdf7;
      border-radius: 28px;
      padding: clamp(16px, 4vw, 36px);
      box-shadow: 0 8px 32px rgba(80,50,150,0.15);
      max-width: 700px;
      width: 100%;
      text-align: center;
    }

    /* ── Dino image container ── */
    #dino-img-wrap {
      width: clamp(160px, 40vw, 280px);
      height: clamp(160px, 40vw, 280px);
      border-radius: 20px;
      overflow: visible;
      margin: 0 auto 28px;
      border: 5px solid #e0d0ff;
      box-shadow: 0 4px 18px rgba(0,0,0,0.13);
      background: #f0f0f0;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: bounce 1.4s infinite alternate ease-in-out;
      position: relative;
      transition: border-color 0.4s, box-shadow 0.4s;
      z-index: 1;
    }

    @keyframes bounce {
      from { transform: translateY(0px); }
      to   { transform: translateY(-12px); }
    }

    /* Reveal animation — triggered on correct answer */
    @keyframes dino-reveal {
      0%   { transform: scale(1); filter: brightness(1); }
      25%  { transform: scale(1.15); filter: brightness(2.2); }
      50%  { transform: scale(1.9); filter: brightness(1.3); }
      75%  { transform: scale(1.75); filter: brightness(1.1); }
      100% { transform: scale(1.7); filter: brightness(1); }
    }

    #dino-img-wrap.revealed {
      animation: dino-reveal 0.85s cubic-bezier(0.34,1.56,0.64,1) forwards !important;
      border-color: #ffd600 !important;
      box-shadow: 0 0 40px rgba(255,214,0,0.7), 0 8px 28px rgba(0,0,0,0.2) !important;
      z-index: 10;
      border-radius: 20px;
      overflow: hidden;
    }

    /* Skeleton image (shown during question) */
    #dino-img-skeleton {
      position: absolute; top: 0; left: 0;
      width: 100%; height: 100%;
      object-fit: contain; padding: 6px;
      background: white;
      transition: opacity 0.45s ease 0.3s;
      display: none;
    }

    /* Life restoration image (revealed on correct answer) */
    #dino-img-real {
      position: absolute; top: 0; left: 0;
      width: 100%; height: 100%;
      object-fit: contain; padding: 6px;
      background: white;
      opacity: 0;
      transition: opacity 0.45s ease 0.3s;
      display: none;
    }

    #dino-img-wrap.revealed #dino-img-skeleton { opacity: 0; }
    #dino-img-wrap.revealed #dino-img-real     { opacity: 1; }

    /* Fallback badge shown while images load or on error */
    #dino-badge {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(1.8rem, 6vw, 3rem);
      font-weight: 900;
      color: white;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.25);
      border-radius: 16px;
      position: absolute;
      top: 0; left: 0;
    }

    .img-credit {
      font-size: 0.65rem;
      color: #aaa;
      margin-top: -10px;
      margin-bottom: 6px;
      font-style: italic;
    }

    #dino-name {
      font-size: clamp(1.6rem, 6vw, 2.8rem);
      font-weight: 900;
      color: #2e7d32;
      margin-bottom: 6px;
    }

    #question-text {
      font-size: clamp(1.05rem, 3.8vw, 1.5rem);
      color: #333;
      margin: 12px 0 20px;
      line-height: 1.4;
      min-height: 2.6em;
    }

    #options-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 10px;
    }

    .opt-btn {
      background: linear-gradient(135deg, #fff3b0, #ffe066);
      border: 4px solid #f9c846;
      border-radius: 18px;
      padding: clamp(12px, 3vw, 20px) 10px;
      font-size: clamp(0.95rem, 3.2vw, 1.35rem);
      font-weight: 700;
      color: #4a2f8a;
      cursor: pointer;
      transition: transform 0.15s, background 0.2s, border-color 0.2s;
      word-break: break-word;
      line-height: 1.3;
    }
    .opt-btn:hover:not(:disabled) {
      transform: scale(1.07);
      background: linear-gradient(135deg, #ffe066, #ffc200);
    }
    .opt-btn.correct {
      background: linear-gradient(135deg, #b9f6ca, #69f0ae);
      border-color: #00c853; color: #1b5e20;
      animation: pop 0.3s ease;
    }
    .opt-btn.wrong {
      background: linear-gradient(135deg, #ffcdd2, #ef9a9a);
      border-color: #e53935; color: #b71c1c;
      animation: shake 0.4s ease;
    }

    @keyframes pop {
      0%   { transform: scale(1); }
      50%  { transform: scale(1.15); }
      100% { transform: scale(1); }
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%  { transform: translateX(-8px); }
      40%  { transform: translateX(8px); }
      60%  { transform: translateX(-6px); }
      80%  { transform: translateX(6px); }
    }

    #feedback-box {
      min-height: 76px;
      padding: 12px 16px;
      border-radius: 16px;
      margin: 12px 0 8px;
      font-size: clamp(0.95rem, 3.3vw, 1.25rem);
      font-weight: 700;
      display: none;
      align-items: center;
      justify-content: center;
      gap: 10px;
      line-height: 1.4;
      text-align: center;
    }
    #feedback-box.correct-fb {
      background: #e8f5e9; color: #2e7d32;
      border: 3px solid #69f0ae; display: flex;
    }
    #feedback-box.wrong-fb {
      background: #fce4ec; color: #880e4f;
      border: 3px solid #ef9a9a; display: flex;
    }

    .fb-label {
      display: inline-block;
      padding: 3px 12px;
      border-radius: 20px;
      font-weight: 900;
      letter-spacing: 1px;
      flex-shrink: 0;
    }
    .fb-label.good { background: #00c853; color: white; }
    .fb-label.bad  { background: #e53935; color: white; }

    #next-btn {
      margin-top: 8px;
      padding: clamp(12px, 3vw, 18px) clamp(28px, 8vw, 55px);
      font-size: clamp(1.05rem, 3.8vw, 1.4rem);
      font-weight: 900;
      background: linear-gradient(135deg, #7c4dff, #e040fb);
      color: white; border: none;
      border-radius: 50px; cursor: pointer;
      box-shadow: 0 6px 20px rgba(124,77,255,0.4);
      transition: transform 0.15s, box-shadow 0.15s;
      display: none; letter-spacing: 1px;
    }
    #next-btn:hover {
      transform: scale(1.07) translateY(-2px);
      box-shadow: 0 10px 28px rgba(124,77,255,0.5);
    }

    #progress-dots {
      display: flex; gap: 8px;
      justify-content: center;
      margin-top: 16px; flex-wrap: wrap;
    }
    .dot { width: 16px; height: 16px; border-radius: 50%; background: #d1c4e9; transition: background 0.3s; }
    .dot.done    { background: #7c4dff; }
    .dot.current { background: #e040fb; transform: scale(1.3); }

    /* ── End screen ── */
    #end-screen {
      display: none; flex-direction: column;
      align-items: center; gap: 16px;
    }
    .trophy-banner {
      background: linear-gradient(135deg, #f9c846, #ff8f00);
      color: white; font-size: clamp(1.6rem, 6vw, 2.4rem);
      font-weight: 900; letter-spacing: 3px;
      padding: 14px 36px; border-radius: 60px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
      box-shadow: 0 6px 20px rgba(249,200,70,0.5);
    }
    #end-screen h2 {
      font-size: clamp(2rem, 7vw, 3rem);
      color: #4a2f8a; text-shadow: 2px 2px 0 #f9c846;
    }
    #final-score {
      font-size: clamp(1.3rem, 5vw, 2rem);
      color: #2e7d32; font-weight: 900;
    }
    #star-display-end {
      font-size: clamp(1.6rem, 6vw, 2.4rem);
      letter-spacing: 6px; color: #f9a825;
    }
    #final-msg {
      font-size: clamp(1rem, 3.5vw, 1.4rem);
      color: #555; max-width: 440px; line-height: 1.5;
    }
    #play-again-btn {
      padding: clamp(14px, 3vw, 20px) clamp(32px, 8vw, 60px);
      font-size: clamp(1.1rem, 4vw, 1.5rem); font-weight: 900;
      background: linear-gradient(135deg, #ff6f00, #ffd600);
      color: white; border: none; border-radius: 50px; cursor: pointer;
      box-shadow: 0 6px 20px rgba(255,111,0,0.35);
      transition: transform 0.15s; letter-spacing: 2px;
    }
    #play-again-btn:hover { transform: scale(1.08); }
    #quiz-area { display: block; }
  </style>
</head>
<body>

<h1>DINO QUIZ!</h1>
<button id="music-btn" onclick="toggleMusic()">MUSIC: OFF</button>
<div id="score-bar">
  <span>Score: <span id="score-num">0</span></span>
  <span id="star-display"></span>
  <span>Question <span id="q-num">1</span> of <span id="q-total">10</span></span>
</div>

<div id="game-area">
  <div id="quiz-area">
    <div id="dino-img-wrap">
      <div id="dino-badge"></div>
      <img id="dino-img-skeleton" alt="Dinosaur fossil" />
      <img id="dino-img-real"     alt="Dinosaur life restoration" />
    </div>
    <div class="img-credit" id="img-credit"></div>
    <div id="dino-name">Loading...</div>
    <div id="question-text">Loading question...</div>
    <div id="options-grid"></div>
    <div id="feedback-box"></div>
    <button id="next-btn" onclick="nextQuestion()">NEXT &#8594;</button>
    <button id="skip-btn" onclick="skipQuestion()">SKIP &#8618;</button>
    <div id="progress-dots"></div>
  </div>

  <div id="end-screen">
    <div class="trophy-banner">WELL DONE!</div>
    <h2>Amazing Job!</h2>
    <div id="final-score"></div>
    <div id="star-display-end"></div>
    <div id="final-msg"></div>
    <button id="play-again-btn" onclick="startGame()">PLAY AGAIN</button>
  </div>
</div>

<script>
// ── BADGE COLOURS ─────────────────────────────────────────────────────────
const COLOURS = {
  "T-Rex": "#c62828", "Triceratops": "#1565c0", "Brachiosaurus": "#2e7d32",
  "Pterodactyl": "#6a1b9a", "Stegosaurus": "#e65100", "Velociraptor": "#00695c",
  "Diplodocus": "#4527a0", "Ankylosaurus": "#558b2f", "Spinosaurus": "#0277bd",
  "Parasaurolophus": "#ad1457", "Iguanodon": "#827717", "Allosaurus": "#bf360c",
  "Pachycephalosaurus": "#4e342e", "Carnotaurus": "#880e4f", "Baryonyx": "#01579b",
  "Edmontosaurus": "#33691e", "Kentrosaurus": "#e65100", "Iguanodon": "#827717",
  "Therizinosaurus": "#006064", "Gallimimus": "#37474f"
};

// ── IMAGE SOURCES ─────────────────────────────────────────────────────────
const WIKI_ARTICLES = {
  "T-Rex": "Tyrannosaurus", "Triceratops": "Triceratops",
  "Brachiosaurus": "Brachiosaurus", "Pterodactyl": "Pterodactylus",
  "Stegosaurus": "Stegosaurus", "Velociraptor": "Velociraptor",
  "Diplodocus": "Diplodocus", "Ankylosaurus": "Ankylosaurus",
  "Spinosaurus": "Spinosaurus", "Parasaurolophus": "Parasaurolophus",
  "Iguanodon": "Iguanodon", "Allosaurus": "Allosaurus",
  "Pachycephalosaurus": "Pachycephalosaurus", "Carnotaurus": "Carnotaurus",
  "Gallimimus": "Gallimimus", "Baryonyx": "Baryonyx",
  "Edmontosaurus": "Edmontosaurus",
};

const skelCache = {};
const realCache = {};

// Skeleton: Wikipedia API (tends to return fossil/skeleton photos)
async function getSkeletonImage(dinoName) {
  if (skelCache[dinoName] !== undefined) return skelCache[dinoName];
  const article = WIKI_ARTICLES[dinoName];
  if (!article) { skelCache[dinoName] = null; return null; }
  try {
    const res = await fetch(
      'https://en.wikipedia.org/api/rest_v1/page/summary/' + encodeURIComponent(article),
      { headers: { 'Accept': 'application/json' } }
    );
    if (!res.ok) throw new Error();
    const data = await res.json();
    const src = data.thumbnail ? data.thumbnail.source : null;
    skelCache[dinoName] = src ? src.replace(/\/\d+px-/, '/380px-') : null;
    return skelCache[dinoName];
  } catch(e) { skelCache[dinoName] = null; return null; }
}

// Life restoration: search Wikimedia Commons dynamically for fleshed-out art
async function getRestorationImage(dinoName) {
  if (realCache[dinoName] !== undefined) return realCache[dinoName];
  try {
    const query = encodeURIComponent(dinoName + ' dinosaur life restoration');
    const searchRes = await fetch(
      'https://commons.wikimedia.org/w/api.php?action=query&list=search' +
      '&srsearch=' + query + '&srnamespace=6&srlimit=8&format=json&origin=*'
    );
    const searchData = await searchRes.json();
    const results = (searchData.query?.search || [])
      .filter(r => /\.(jpg|jpeg|png)$/i.test(r.title));
    if (!results.length) { realCache[dinoName] = null; return null; }
    const title = results[0].title;
    const infoRes = await fetch(
      'https://commons.wikimedia.org/w/api.php?action=query' +
      '&titles=' + encodeURIComponent(title) +
      '&prop=imageinfo&iiprop=url&iiurlwidth=400&format=json&origin=*'
    );
    const infoData = await infoRes.json();
    const pages = Object.values(infoData.query?.pages || {});
    realCache[dinoName] = pages[0]?.imageinfo?.[0]?.thumburl || null;
    return realCache[dinoName];
  } catch(e) { realCache[dinoName] = null; return null; }
}

// ── LARGE QUESTION BANK (30 questions) ───────────────────────────────────
const ALL_QUESTIONS = [
  // T-Rex (3 questions)
  {
    dino: "T-Rex",
    question: "What did T-Rex like to eat?",
    options: ["Leaves", "Meat", "Fish", "Berries"],
    answer: 1,
    fact: "T-Rex was a huge meat-eater called a carnivore! Its teeth were as big as bananas!"
  },
  {
    dino: "T-Rex",
    question: "T-Rex had two very tiny what?",
    options: ["Eyes", "Arms", "Ears", "Toes"],
    answer: 1,
    fact: "T-Rex had surprisingly tiny arms — but they were still very strong! Scientists still debate what they were used for."
  },
  {
    dino: "T-Rex",
    question: "About how long was a full-grown T-Rex?",
    options: ["3 metres", "40 metres", "12 metres", "1 metre"],
    answer: 2,
    fact: "T-Rex could grow up to about 12 metres long — that is as long as a double-decker bus!"
  },

  // Triceratops (2 questions)
  {
    dino: "Triceratops",
    question: "How many horns did Triceratops have?",
    options: ["1 horn", "2 horns", "3 horns", "4 horns"],
    answer: 2,
    fact: "Triceratops had 3 big horns on its face! The name means three-horned face!"
  },
  {
    dino: "Triceratops",
    question: "Triceratops had a large bony what on its head?",
    options: ["Crown", "Frill", "Spike", "Crest"],
    answer: 1,
    fact: "Triceratops had a large bony frill around the back of its head. It may have been used to attract a mate or scare enemies!"
  },

  // Brachiosaurus (2 questions)
  {
    dino: "Brachiosaurus",
    question: "Brachiosaurus had a super long what?",
    options: ["Tail", "Neck", "Nose", "Tongue"],
    answer: 1,
    fact: "Brachiosaurus had an incredibly long neck to eat leaves from the tops of tall trees!"
  },
  {
    dino: "Brachiosaurus",
    question: "Brachiosaurus only ate what?",
    options: ["Other dinosaurs", "Fish", "Plants", "Insects"],
    answer: 2,
    fact: "Brachiosaurus was a herbivore — it only ate plants! It needed to eat huge amounts every day to fuel its giant body."
  },

  // Pterodactyl (2 questions)
  {
    dino: "Pterodactyl",
    question: "Pterodactyl could do something birds do — what?",
    options: ["Swim", "Fly", "Dig", "Jump"],
    answer: 1,
    fact: "Pterodactyls could fly through the sky using their giant wings! They were not dinosaurs — they were flying reptiles!"
  },
  {
    dino: "Pterodactyl",
    question: "Was a Pterodactyl actually a dinosaur?",
    options: ["Yes, a big one", "No, a flying reptile", "No, a bird", "Yes, a tiny one"],
    answer: 1,
    fact: "Pterodactyls were NOT dinosaurs! They were flying reptiles called pterosaurs that lived at the same time as dinosaurs."
  },

  // Stegosaurus (2 questions)
  {
    dino: "Stegosaurus",
    question: "Stegosaurus had big bony plates on its what?",
    options: ["Feet", "Head", "Back", "Tail only"],
    answer: 2,
    fact: "Stegosaurus had huge bony plates running along its back. Scientists are still figuring out what they were for!"
  },
  {
    dino: "Stegosaurus",
    question: "Stegosaurus had spikes on its what?",
    options: ["Head", "Hands", "Tail", "Feet"],
    answer: 2,
    fact: "Stegosaurus had four sharp spikes on its tail, which it could swing to defend itself from predators!"
  },

  // Velociraptor (2 questions)
  {
    dino: "Velociraptor",
    question: "Velociraptors were actually about the size of a...",
    options: ["Bus", "Turkey", "Elephant", "Cat"],
    answer: 1,
    fact: "Real Velociraptors were only about the size of a turkey! They were very clever hunters though!"
  },
  {
    dino: "Velociraptor",
    question: "Real Velociraptors were probably covered in...",
    options: ["Scales", "Feathers", "Fur", "Slime"],
    answer: 1,
    fact: "Scientists now believe Velociraptors had feathers! They were more like feathered birds than the scaly monsters in films."
  },

  // Diplodocus (2 questions)
  {
    dino: "Diplodocus",
    question: "Which part of Diplodocus was VERY long?",
    options: ["Arms", "Nose", "Tail", "Claws"],
    answer: 2,
    fact: "Diplodocus had an amazingly long tail that could be used like a whip! It could grow up to 27 metres long!"
  },
  {
    dino: "Diplodocus",
    question: "How did Diplodocus eat leaves from trees?",
    options: ["It climbed trees", "It used its long neck", "It jumped up high", "It waited for them to fall"],
    answer: 1,
    fact: "Diplodocus used its long neck to reach leaves on tall trees — like a living crane! It was a plant-eater."
  },

  // Ankylosaurus (2 questions)
  {
    dino: "Ankylosaurus",
    question: "Ankylosaurus had hard armour all over its...",
    options: ["Wings", "Back and sides", "Belly only", "Head only"],
    answer: 1,
    fact: "Ankylosaurus was like a living tank! Hard bony armour covered its back and sides to protect it from predators!"
  },
  {
    dino: "Ankylosaurus",
    question: "Ankylosaurus had a special weapon on its...",
    options: ["Head", "Front feet", "Tail", "Back"],
    answer: 2,
    fact: "Ankylosaurus had a huge bony club at the end of its tail. It could swing it hard enough to break bones!"
  },

  // Spinosaurus (2 questions)
  {
    dino: "Spinosaurus",
    question: "What did Spinosaurus love to eat?",
    options: ["Insects", "Grass", "Fish", "Eggs"],
    answer: 2,
    fact: "Spinosaurus loved eating fish! It was one of the biggest meat-eating dinosaurs ever — even bigger than T-Rex!"
  },
  {
    dino: "Spinosaurus",
    question: "Spinosaurus had a large sail on its...",
    options: ["Head", "Back", "Tail", "Belly"],
    answer: 1,
    fact: "Spinosaurus had a huge sail made of tall spines on its back. It may have helped control its body temperature!"
  },

  // Parasaurolophus (2 questions)
  {
    dino: "Parasaurolophus",
    question: "Parasaurolophus had a big crest on its head. What might it have used it for?",
    options: ["Digging", "Making sounds", "Smelling", "Seeing"],
    answer: 1,
    fact: "Scientists think Parasaurolophus used its hollow crest to make loud, booming sounds to talk to its friends!"
  },
  {
    dino: "Parasaurolophus",
    question: "Parasaurolophus walked mostly on how many legs?",
    options: ["Just 2", "Just 4", "Both 2 and 4", "6 legs"],
    answer: 2,
    fact: "Parasaurolophus could walk on two legs or four legs depending on what it was doing — very flexible!"
  },

  // Iguanodon (2 questions)
  {
    dino: "Iguanodon",
    question: "Iguanodon had a special spike on which part?",
    options: ["Its back", "Its thumb", "Its knee", "Its tail"],
    answer: 1,
    fact: "Iguanodon had a sharp spike on each thumb! It might have used them to defend itself or to crack open fruit!"
  },
  {
    dino: "Iguanodon",
    question: "Iguanodon was one of the first dinosaurs ever...",
    options: ["Cloned", "Discovered", "Photographed", "Tamed"],
    answer: 1,
    fact: "Iguanodon was one of the very first dinosaurs ever officially discovered and named — back in 1825!"
  },

  // Allosaurus (2 questions)
  {
    dino: "Allosaurus",
    question: "Allosaurus was a fierce hunter. What group does it belong to?",
    options: ["Plant-eaters", "Fish-eaters", "Meat-eaters", "Insect-eaters"],
    answer: 2,
    fact: "Allosaurus was one of the top meat-eating predators of its time — a bit like the T-Rex of its age!"
  },
  {
    dino: "Allosaurus",
    question: "Allosaurus hunted during which period?",
    options: ["Triassic", "Jurassic", "Cretaceous", "Ice Age"],
    answer: 1,
    fact: "Allosaurus lived during the Jurassic period, about 155 million years ago — long before T-Rex appeared!"
  },

  // Extra dinosaurs
  {
    dino: "Pachycephalosaurus",
    question: "Pachycephalosaurus had a very thick, dome-shaped...",
    options: ["Tail", "Shell", "Skull", "Claw"],
    answer: 2,
    fact: "Pachycephalosaurus had a skull up to 25cm thick! It may have head-butted rivals to show who was strongest!"
  },
  {
    dino: "Carnotaurus",
    question: "Carnotaurus is famous for having horns above its...",
    options: ["Nose", "Eyes", "Ears", "Mouth"],
    answer: 1,
    fact: "Carnotaurus had two stubby horns above its eyes — making it look like a scary bull! Its name means meat-eating bull."
  },
  {
    dino: "Gallimimus",
    question: "Gallimimus looked a lot like which modern animal?",
    options: ["A horse", "An ostrich", "A penguin", "A dolphin"],
    answer: 1,
    fact: "Gallimimus looked very much like a giant ostrich! It was one of the fastest dinosaurs and could run at high speeds."
  },
  {
    dino: "Baryonyx",
    question: "Baryonyx had very large curved claws on its...",
    options: ["Back feet", "Front hands", "Tail", "Head"],
    answer: 1,
    fact: "Baryonyx had huge hooked claws on its hands — perfect for catching fish from rivers, which was its favourite food!"
  },
  {
    dino: "Edmontosaurus",
    question: "Edmontosaurus is sometimes called a duck-billed dinosaur because of its...",
    options: ["Flat tail", "Wide flat beak", "Big round eyes", "Webbed feet"],
    answer: 1,
    fact: "Edmontosaurus had a wide, flat beak shaped just like a duck's bill — perfect for munching on plants and tough leaves!"
  },
];

// ── GAME STATE ─────────────────────────────────────────────────────────────
let questions = [];
let current = 0;
let score = 0;
let answered = false;
let playCount = 0;

function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function startGame() {
  playCount++;
  // Ensure variety: pick from shuffled pool; on replays, rotate which questions appear
  const pool = shuffle(ALL_QUESTIONS);
  // Deduplicate by dino so we don't get two questions from same dino in a row
  const seen = new Set();
  const deduped = [];
  for (const q of pool) {
    if (!seen.has(q.dino)) { deduped.push(q); seen.add(q.dino); }
  }
  // Fill remaining slots from leftovers
  for (const q of pool) {
    if (deduped.length >= 15) break;
    if (!deduped.includes(q)) deduped.push(q);
  }
  questions = deduped.slice(0, 15);

  current = 0;
  score = 0;
  document.getElementById('end-screen').style.display = 'none';
  document.getElementById('quiz-area').style.display = 'block';
  updateScoreDisplay();
  showQuestion();
}

async function showQuestion() {
  answered = false;
  const q = questions[current];

  const badge   = document.getElementById('dino-badge');
  const skelImg = document.getElementById('dino-img-skeleton');
  const realImg = document.getElementById('dino-img-real');
  const wrap    = document.getElementById('dino-img-wrap');
  const credit  = document.getElementById('img-credit');

  // Reset wrap — remove reveal class, restore bounce animation
  wrap.classList.remove('revealed');
  wrap.style.animation = '';
  void wrap.offsetWidth; // force reflow so bounce restarts
  wrap.style.animation = null;

  // Show badge placeholder while images load
  const col = COLOURS[q.dino] || '#5e35b1';
  badge.style.background = 'radial-gradient(circle at 35% 35%, ' + lighten(col) + ', ' + col + ')';
  badge.textContent = q.dino.substring(0, 2).toUpperCase();
  badge.style.display = 'flex';
  skelImg.style.display    = 'none';
  realImg.style.display    = 'none';
  skelImg.style.opacity    = '1';
  realImg.style.opacity    = '0';
  skelImg.style.transition = '';
  realImg.style.transition = '';
  wrap.style.borderColor   = '#e0d0ff';
  credit.textContent = '';

  document.getElementById('dino-name').textContent = q.dino;
  document.getElementById('question-text').textContent = q.question;
  document.getElementById('q-num').textContent = current + 1;
  document.getElementById('q-total').textContent = questions.length;

  // Build option buttons
  const grid = document.getElementById('options-grid');
  grid.innerHTML = '';
  q.options.forEach((opt, i) => {
    const btn = document.createElement('button');
    btn.className = 'opt-btn';
    btn.textContent = opt;
    btn.onclick = () => selectAnswer(i);
    grid.appendChild(btn);
  });

  // Reset feedback / buttons
  const fb = document.getElementById('feedback-box');
  fb.className = ''; fb.style.display = 'none'; fb.innerHTML = '';
  document.getElementById('next-btn').style.display = 'none';
  document.getElementById('skip-btn').style.display = 'inline-block';

  // Progress dots
  const dots = document.getElementById('progress-dots');
  dots.innerHTML = '';
  questions.forEach((_, i) => {
    const d = document.createElement('div');
    d.className = 'dot' + (i < current ? ' done' : i === current ? ' current' : '');
    dots.appendChild(d);
  });

  // ── Load SKELETON image (Wikipedia API — often shows fossil photos) ──────
  getSkeletonImage(q.dino).then(skelSrc => {
    if (skelSrc) {
      skelImg.onload = () => {
        badge.style.display = 'none';
        skelImg.style.display = 'block';
        credit.textContent = 'Image: Wikipedia / Wikimedia Commons';
      };
      skelImg.onerror = () => { /* badge stays */ };
      skelImg.src = skelSrc;
    }
  });

  // ── Pre-load LIFE RESTORATION (Wikimedia Commons search) in background ───
  getRestorationImage(q.dino).then(realSrc => {
    if (realSrc) {
      realImg.onload = () => { realImg.style.display = 'block'; };
      realImg.src = realSrc;
    }
  });
}

function selectAnswer(idx) {
  if (answered) return;
  answered = true;

  const q = questions[current];
  const btns = document.querySelectorAll('.opt-btn');
  btns.forEach(b => b.disabled = true);

  const fb = document.getElementById('feedback-box');

  if (idx === q.answer) {
    score++;
    btns[idx].classList.add('correct');
    fb.className = 'correct-fb';
    fb.innerHTML = '<span class="fb-label good">CORRECT!</span> ' + q.fact;
    playSound(true);
    // ── Reveal: skeleton bursts into life restoration ──────────────────────
    const wrap    = document.getElementById('dino-img-wrap');
    const skelImg = document.getElementById('dino-img-skeleton');
    const realImg = document.getElementById('dino-img-real');
    realImg.style.display = 'block';
    wrap.classList.add('revealed');
    // Explicitly swap opacity via inline style (overrides CSS class)
    setTimeout(() => {
      skelImg.style.transition = 'opacity 0.5s ease';
      realImg.style.transition  = 'opacity 0.5s ease';
      skelImg.style.opacity = '0';
      realImg.style.opacity  = '1';
      document.getElementById('img-credit').textContent = 'Image: Wikimedia Commons (life restoration)';
    }, 250);
    // ── Auto-advance after 5 seconds ───────────────────────────────────────
    setTimeout(() => nextQuestion(), 5000);
  } else {
    btns[idx].classList.add('wrong');
    btns[q.answer].classList.add('correct');
    fb.className = 'wrong-fb';
    fb.innerHTML = '<span class="fb-label bad">OOPS!</span> The answer was: <strong>' +
      q.options[q.answer] + '</strong>. ' + q.fact;
    playSound(false);
  }

  updateScoreDisplay();
  document.getElementById('skip-btn').style.display = 'none';
  // Only show Next button on wrong answers; correct ones auto-advance
  if (idx !== questions[current].answer) {
    const nextBtn = document.getElementById('next-btn');
    nextBtn.style.display = 'inline-block';
    nextBtn.textContent = current < questions.length - 1 ? 'NEXT \u2192' : 'SEE MY SCORE!';
  }
}

function nextQuestion() {
  current++;
  if (current >= questions.length) showEndScreen();
  else showQuestion();
}

function showEndScreen() {
  document.getElementById('quiz-area').style.display = 'none';
  const end = document.getElementById('end-screen');
  end.style.display = 'flex';

  const pct = score / questions.length;
  let msg, stars;
  if (pct === 1) {
    stars = '\u2605\u2605\u2605\u2605\u2605';
    msg = 'WOW! You got every single one right! You are a Dino Expert!';
  } else if (pct >= 0.7) {
    stars = '\u2605\u2605\u2605\u2605';
    msg = 'Super job! You know SO much about dinosaurs! Keep it up!';
  } else if (pct >= 0.4) {
    stars = '\u2605\u2605\u2605';
    msg = 'Great try! Play again to discover more dino facts!';
  } else {
    stars = '\u2605\u2605';
    msg = 'Good try! Dinosaurs are tricky. Play again to learn more!';
  }

  document.getElementById('final-score').textContent =
    'You got ' + score + ' out of ' + questions.length + '!';
  document.getElementById('star-display-end').textContent = stars;
  document.getElementById('final-msg').textContent = msg;
}

function updateScoreDisplay() {
  document.getElementById('score-num').textContent = score;
  const filled = Math.round((score / Math.max(current, 1)) * 3);
  const f = Math.min(filled, 3);
  document.getElementById('star-display').textContent =
    '\u2605'.repeat(f) + '\u2606'.repeat(3 - f);
}

function lighten(hex) {
  const r = parseInt(hex.slice(1,3),16);
  const g = parseInt(hex.slice(3,5),16);
  const b = parseInt(hex.slice(5,7),16);
  const l = v => Math.min(255, Math.round(v + (255 - v) * 0.45));
  return 'rgb(' + l(r) + ',' + l(g) + ',' + l(b) + ')';
}

// ── SKIP ──────────────────────────────────────────────────────────────────
function skipQuestion() {
  if (answered) return;
  answered = true;
  const q = questions[current];
  const btns = document.querySelectorAll('.opt-btn');
  btns.forEach(b => b.disabled = true);
  btns[q.answer].classList.add('correct');
  const fb = document.getElementById('feedback-box');
  fb.className = 'wrong-fb';
  fb.innerHTML = '<span class="fb-label bad">SKIPPED!</span> The answer was: <strong>' +
    q.options[q.answer] + '</strong>. ' + q.fact;
  document.getElementById('skip-btn').style.display = 'none';
  const nextBtn = document.getElementById('next-btn');
  nextBtn.style.display = 'inline-block';
  nextBtn.textContent = current < questions.length - 1 ? 'NEXT \u2192' : 'SEE MY SCORE!';
  updateScoreDisplay();
}

// ── AUDIO ─────────────────────────────────────────────────────────────────
let audioCtx = null;
function getCtx() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  return audioCtx;
}

// ── BACKGROUND MUSIC (original "Dino Adventure" theme) ────────────────────
let musicPlaying = false;
let musicLoopTimeout = null;
let musicGainNode = null;

// Original composition — heroic adventure melody
const MELODY = [
  // Phrase 1: heroic rise
  [392,0.30],[494,0.30],[587,0.30],[784,0.60],
  [659,0.30],[587,0.30],[494,0.60],[0,0.30],
  // Phrase 2: adventure call
  [392,0.30],[523,0.30],[659,0.30],[587,0.30],
  [523,0.30],[494,0.30],[440,0.60],[0,0.30],
  // Phrase 3: march
  [494,0.30],[494,0.15],[523,0.15],[587,0.30],
  [659,0.30],[587,0.30],[523,0.30],[494,0.60],[0,0.30],
  // Phrase 4: grand resolution
  [392,0.30],[440,0.30],[494,0.30],[523,0.30],
  [587,0.30],[784,0.30],[784,0.90],[0,0.30],
];

// Simple walking bass pattern (repeats)
const BASS = [
  [196,0.60],[0,0.15],[294,0.45],
  [196,0.60],[0,0.15],[247,0.45],
];

function melodyDuration() {
  return MELODY.reduce((s, n) => s + n[1], 0);
}

function scheduleLoop(notes, type, vol, startTime, endTime) {
  const ctx = getCtx();
  let t = startTime;
  while (t < endTime) {
    for (const [freq, dur] of notes) {
      if (t >= endTime) break;
      if (freq > 0) {
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.connect(g);
        g.connect(musicGainNode);
        o.type = type;
        o.frequency.setValueAtTime(freq, t);
        g.gain.setValueAtTime(vol, t);
        g.gain.exponentialRampToValueAtTime(0.001, t + dur * 0.88);
        o.start(t);
        o.stop(t + dur);
      }
      t += dur;
    }
  }
}

function playMusicLoop() {
  if (!musicPlaying) return;
  const ctx = getCtx();
  const start = ctx.currentTime + 0.05;
  const dur   = melodyDuration();

  if (!musicGainNode || musicGainNode.context.state === 'closed') {
    musicGainNode = ctx.createGain();
    musicGainNode.gain.setValueAtTime(0.13, ctx.currentTime);
    musicGainNode.connect(ctx.destination);
  }

  scheduleLoop(MELODY, 'sine',     0.15, start, start + dur);
  scheduleLoop(BASS,   'triangle', 0.08, start, start + dur);

  musicLoopTimeout = setTimeout(playMusicLoop, (dur - 0.1) * 1000);
}

function startMusic() {
  if (musicPlaying) return;
  musicPlaying = true;
  const ctx = getCtx();
  musicGainNode = ctx.createGain();
  musicGainNode.gain.setValueAtTime(0.13, ctx.currentTime);
  musicGainNode.connect(ctx.destination);
  playMusicLoop();
}

function stopMusic() {
  musicPlaying = false;
  clearTimeout(musicLoopTimeout);
  if (musicGainNode) {
    try {
      const ctx = getCtx();
      musicGainNode.gain.setValueAtTime(musicGainNode.gain.value, ctx.currentTime);
      musicGainNode.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.4);
      setTimeout(() => { try { musicGainNode.disconnect(); } catch(e){} musicGainNode = null; }, 500);
    } catch(e) { musicGainNode = null; }
  }
}

function toggleMusic() {
  const btn = document.getElementById('music-btn');
  if (musicPlaying) {
    stopMusic();
    btn.textContent = 'MUSIC: OFF';
    btn.classList.remove('on');
  } else {
    startMusic();
    btn.textContent = 'MUSIC: ON';
    btn.classList.add('on');
  }
}


function playSound(correct) { /* sounds removed */ }

// ── START ─────────────────────────────────────────────────────────────────
startGame();
</script>
</body>
</html>
